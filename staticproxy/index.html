<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Sven Ruppert">
        
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>StaticProxy - ProxyBuilder</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-35462441-5', 'ProxyBuilder');
            ga('send', 'pageview');
        </script>
        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="..">ProxyBuilder</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Home</a>
                    </li>
                
                
                
                    <li >
                        <a href="../dynamicproxy/">DynamicProxy</a>
                    </li>
                
                
                
                    <li >
                        <a href="../objectadapter/">ObjectAdapter</a>
                    </li>
                
                
                
                    <li class="active">
                        <a href="./">StaticProxy</a>
                    </li>
                
                
                
                    <li >
                        <a href="../projectinfos/">Projectinfos</a>
                    </li>
                
                
                
                    <li >
                        <a href="../additionalinfos/">Additional Infos</a>
                    </li>
                
                
                
                    <li >
                        <a href="../about/">About</a>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../objectadapter/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../projectinfos/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#static-proxies">Static Proxies</a></li>
        
            <li><a href="#generated">Generated</a></li>
        
            <li><a href="#runtime-generated">Runtime Generated</a></li>
        
            <li><a href="#static-generated-virtualproxy">Static Generated VirtualProxy</a></li>
        
            <li><a href="#static-generated-metricsproxy">Static Generated MetricsProxy</a></li>
        
            <li><a href="#static-generated-loggingproxy">Static Generated LoggingProxy</a></li>
        
            <li><a href="#static-runtime-virtualproxy">Static Runtime VirtualProxy</a></li>
        
            <li><a href="#static-runtime-metricsproxy">Static Runtime MetricsProxy</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="static-proxies">Static Proxies<a class="headerlink" href="#static-proxies" title="Permanent link">&para;</a></h1>
<p>Compared to the DynamicProxies we are now generating static proxies. This could be done with 
<strong><em>AnnotationProcessing</em></strong> during the compile process or at runtime.</p>
<h2 id="generated">Generated<a class="headerlink" href="#generated" title="Permanent link">&para;</a></h2>
<p>Using <strong><em>AnnotationProcessing</em></strong> to generate the Proxies will give you the possibility to get 
proxies without the overhead of Reflection. On the other side you will generate maybe a lot of code, that must be compiled.</p>
<h2 id="runtime-generated">Runtime Generated<a class="headerlink" href="#runtime-generated" title="Permanent link">&para;</a></h2>
<p>Compared to the way of using <strong><em>AnnotationProcessing</em></strong> this one will create and compile at runtime the static proxies. This
is possible if you have access to the Compiler (tools.jar) during runtime and will mostly lead you to use Unsafe to put your new classes to the SystemClassLoader.</p>
<h2 id="static-generated-virtualproxy">Static Generated VirtualProxy<a class="headerlink" href="#static-generated-virtualproxy" title="Permanent link">&para;</a></h2>
<p>With the Annotation <strong><em>@StaticVirtualProxy</em></strong> you can generate Static - VirtualProxies during the clean compile process. This Annotation have a parameter called <strong><em>strategy</em></strong>. The Strategy is used to define the right time to call the <strong><em>InstanceFactory</em></strong>
See <a href="../dynamicproxy/#creationstrategies">DynamicProxies - CreationStrategies</a></p>
<h2 id="static-generated-metricsproxy">Static Generated MetricsProxy<a class="headerlink" href="#static-generated-metricsproxy" title="Permanent link">&para;</a></h2>
<p>With the static <strong><em>MetricsProxy</em></strong> we will get generated MetricsProxies that are using Dropwizard-Metrics to measure the 
usage of the methods. The generated static MetricsProxies are generating Methods for all declared Methods in the inheritance including <strong><em>hashCode()</em></strong> and <strong><em>equals()</em></strong>. You can use the Annotation  <strong><em>@StaticMetricsProxy</em></strong> in combination with interfaces and classes.</p>
<p>There is one difference between the generated classes based on interfaces and classes. If you annotate an interface you will only get Metrics for the declared Methods, not for <strong><em>hashCode</em></strong> and <strong><em>equals</em></strong> if it is not explicitly declared. But for annotated classes you will get the Metrics for methods from Object, too.</p>
<pre><code class="java">@StaticMetricsProxy
public interface Service {
  String doWork(String txt);

  String doMoreWorkA(String txt);

  String doMoreWorkB(String txt);

  String doMoreWorkC(String txt);

  String doMoreWorkD(String txt);
}
</code></pre>

<p>You can use the MetricsProxy easily by creating an instance and setting the Delegator. After this
every Methodcall will be counted by DropwizardMetrics. For every Method, you will get a separate Histogram, named with the full Classname and Methodname. In my case you will get a Histogram with the name
<strong><em>org.rapidpm.demo.proxybuilder.staticproxy.v002.Service.doMoreWorkC</em></strong></p>
<pre><code class="java">    final ServiceStaticMetricsProxy proxy = new ServiceStaticMetricsProxy();
    proxy.withDelegator(new ServiceImpl());

    final Service service = proxy;

    RapidPMMetricsRegistry.getInstance().startConsoleReporter();
    try (final IntStream intStream = IntStream.range(0, 10_000_000)) {
      intStream
          .onClose(() -&gt; out.println(&quot;Stream will be closed now...&quot;))

          .forEach(i -&gt; service.doMoreWorkC(&quot;aaahhhhhh &quot; + i));
    }

    RapidPMMetricsRegistry
        .getInstance()
        .getMetrics()
        .getHistograms()
        .forEach((s, histogram) -&gt; {
          out.println(&quot;s = &quot; + s);
          out.println(&quot;histogram - get999thPercentile= &quot; + histogram.getSnapshot().get999thPercentile());
        });
</code></pre>

<h2 id="static-generated-loggingproxy">Static Generated LoggingProxy<a class="headerlink" href="#static-generated-loggingproxy" title="Permanent link">&para;</a></h2>
<p>Quite often I could find source code like the following.</p>
<pre><code class="java">public void doWork(String str){
    logger.debug(&quot;doWork -&gt; &quot; + str);
    //some work....
}
</code></pre>

<p>The target is a logging of the methodcalls and the values. OK, we don´t want to discuss why or why not. But if you have to do it, you could
now use the <strong><em>LoggingProxy</em></strong>. The Logging is implemented with <strong><em>slf4j</em></strong>. Every method call will be logged with 
the methodname, the name of the params and the param values itself. With this information you could find the corresponding source code very easy.</p>
<p>Based on the following definition of a method...</p>
<pre><code class="java">    public &lt;T extends List&gt; T unwrapList(final T type, final String str);
</code></pre>

<p>you will get an implementation like the follwoing.</p>
<pre><code class="java">  public &lt;T extends List&gt; T unwrapList(final T type, final String str) {
    if (logger.isInfoEnabled()) {
      logger.info(&quot;delegator.unwrapList(type, str) values - &quot; + type + &quot; - &quot; + str);
    }
    T result = delegator.unwrapList(type, str);
    return result;
  }
</code></pre>

<p>This implementation will asume, that the values are using a proper <strong><em>toString()</em></strong> implementation itself.</p>
<p>If you want to generate a StaticLoggingProxy, please add the Annotation <strong><em>@StaticLoggingProxy</em></strong> to the target class or interface.</p>
<p>Here you will get the full example.</p>
<pre><code class="java">@StaticLoggingProxy
public interface MyLoggingInterface {
  &lt;T extends List&gt; T unwrapList(T type, String str);
}

//generated code
@Generated(
    value = &quot;StaticLoggingProxyAnnotationProcessor&quot;,
    date = &quot;2016-05-09T14:40:56.22&quot;,
    comments = &quot;www.proxybuilder.org&quot;
)
@IsGeneratedProxy
@IsLoggingProxy
public class MyLoggingInterfaceStaticLoggingProxy implements MyLoggingInterface {
  private static final Logger logger = getLogger(MyLoggingInterface.class);

  private MyLoggingInterface delegator;

  public MyLoggingInterfaceStaticLoggingProxy withDelegator(final MyLoggingInterface delegator) {
    this.delegator = delegator;
    return this;
  }

  public &lt;T extends List&gt; T unwrapList(final T type, final String str) {
    if(logger.isInfoEnabled()) {
      logger.info(&quot;delegator.unwrapList(type, str) values - &quot; + type + &quot; - &quot; + str);
    }
    T result = delegator.unwrapList(type, str);
    return result;
  }
}

// demo code usage
public class MainV008 {
  public static void main(String[] args) {
    final MyLoggingInterface demo
        = new MyLoggingInterfaceStaticLoggingProxy()
        .withDelegator(new LoggerExample());
    final List&lt;Integer&gt; list = demo.unwrapList(asList(1,2,3,4), &quot;AEAEA&quot;);
  }

  public static class LoggerExample implements MyLoggingInterface {
    @Override
    public &lt;T extends List&gt; T unwrapList(final T type, final String str) {
      return null;
    }
  }
}
</code></pre>

<p>The logging output will be <code>delegator.unwrapList(type, str) values - [1, 2, 3, 4] - AEAEA</code></p>
<h2 id="static-runtime-virtualproxy">Static Runtime VirtualProxy<a class="headerlink" href="#static-runtime-virtualproxy" title="Permanent link">&para;</a></h2>
<p>partly implemented until now.. stay tuned</p>
<h2 id="static-runtime-metricsproxy">Static Runtime MetricsProxy<a class="headerlink" href="#static-runtime-metricsproxy" title="Permanent link">&para;</a></h2>
<p>partly implemented until now.. stay tuned</p></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
